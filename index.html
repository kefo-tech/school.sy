<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>school.sy â€” Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…Ø¯Ø§Ø±Ø³</title>

  <style>
    :root{
      --bg: #f6f8ff;
      --ink:#0f172a;
      --muted:#64748b;
      --card:#ffffff;
      --line: rgba(15,23,42,.10);
      --shadow: 0 10px 26px rgba(2,6,23,.10);
      --r:18px;
      --primary:#2563eb;
      --primary2:#06b6d4;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Noto Kufi Arabic", "Noto Sans Arabic", sans-serif;
      background:
        radial-gradient(900px 500px at 15% 0%, rgba(37,99,235,.16), transparent 60%),
        radial-gradient(800px 450px at 85% 5%, rgba(6,182,212,.14), transparent 55%),
        linear-gradient(180deg, #eef7ff, var(--bg));
      color:var(--ink);
    }

    .container{
      max-width: 1180px;
      margin: 0 auto;
      padding: 14px 14px 40px;
    }

    /* ===== Hero ===== */
    .hero{
      position: relative;
      border-radius: 22px;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,.25);
      box-shadow: var(--shadow);
      min-height: 220px;
      background:
        linear-gradient(135deg, rgba(37,99,235,.90), rgba(6,182,212,.80)),
        url("https://images.unsplash.com/photo-1523240795612-9a054b0db644?auto=format&fit=crop&w=1600&q=60");
      background-size: cover;
      background-position: center;
      isolation: isolate;
    }
    .hero::after{
      content:"";
      position:absolute; inset:0;
      background: linear-gradient(180deg, rgba(2,6,23,.05), rgba(2,6,23,.55));
      z-index:0;
    }
    .heroInner{
      position: relative;
      z-index:1;
      padding: 20px 18px;
      display:flex;
      gap: 14px;
      align-items:flex-end;
      justify-content: space-between;
      flex-wrap: wrap;
      color:#fff;
    }
    .brand{
      display:flex;
      gap:12px;
      align-items:center;
    }
    .logo{
      width:52px;height:52px;border-radius:16px;
      display:grid;place-items:center;
      background: rgba(255,255,255,.18);
      border: 1px solid rgba(255,255,255,.25);
      backdrop-filter: blur(10px);
      font-weight: 900;
      font-size: 22px;
    }
    .heroTitle{
      font-weight: 1000;
      font-size: clamp(22px, 3vw, 34px);
      margin:0;
      line-height: 1.15;
    }
    .heroSub{
      margin-top:6px;
      opacity:.92;
      max-width: 720px;
      line-height:1.6;
    }

    .heroBadges{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap: wrap;
    }
    .chip{
      padding: 9px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.16);
      border: 1px solid rgba(255,255,255,.25);
      backdrop-filter: blur(10px);
      font-weight: 800;
      font-size: 13px;
      white-space: nowrap;
    }

    /* ===== Sections ===== */
    .section{
      margin-top: 18px;
    }
    .sectionHead{
      display:flex;
      align-items:flex-end;
      justify-content: space-between;
      gap:12px;
      flex-wrap: wrap;
      margin: 18px 2px 10px;
    }
    .sectionHead h2{
      margin:0;
      font-size: 18px;
      font-weight: 1000;
    }
    .hint{
      color: var(--muted);
      font-size: 13px;
    }

    /* ===== Top 3 schools ===== */
    .top3{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }
    .topCard{
      background: rgba(255,255,255,.78);
      border: 1px solid var(--line);
      border-radius: var(--r);
      box-shadow: 0 8px 20px rgba(2,6,23,.08);
      padding: 12px;
      display:flex;
      gap: 12px;
      align-items:center;
      min-height: 88px;
    }
    .avatar{
      width:58px;height:58px;border-radius: 50%;
      overflow:hidden;
      border: 3px solid rgba(37,99,235,.18);
      background: #e2e8f0;
      flex: 0 0 auto;
      display:grid;
      place-items:center;
      font-weight: 1000;
      color:#0f172a;
    }
    .avatar img{ width:100%;height:100%;object-fit:cover; display:block; }
    .topMeta{ min-width:0; }
    .topName{
      font-weight: 1000;
      margin:0;
      font-size: 15px;
      overflow:hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: 240px;
    }
    .topVotes{
      margin-top: 4px;
      font-size: 13px;
      color: var(--muted);
      font-weight: 800;
    }
    .rank{
      margin-inline-start:auto;
      font-weight: 1000;
      color: #fff;
      background: linear-gradient(135deg, var(--primary), var(--primary2));
      border-radius: 12px;
      padding: 6px 10px;
      font-size: 13px;
      box-shadow: 0 10px 18px rgba(37,99,235,.18);
    }

    /* ===== Filters ===== */
    .filters{
      background: rgba(255,255,255,.78);
      border: 1px solid var(--line);
      border-radius: var(--r);
      box-shadow: 0 8px 18px rgba(2,6,23,.06);
      padding: 12px;
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items:center;
    }
    .filters input, .filters select{
      border-radius: 14px;
      border: 1px solid rgba(15,23,42,.12);
      background: rgba(255,255,255,.85);
      padding: 10px 12px;
      outline: none;
      min-width: 220px;
      font-weight: 700;
    }
    .filters input:focus, .filters select:focus{
      border-color: rgba(37,99,235,.35);
      box-shadow: 0 0 0 5px rgba(37,99,235,.12);
    }
    .count{
      margin-inline-start:auto;
      color: var(--muted);
      font-size: 13px;
      font-weight: 900;
    }

    /* ===== Schools grid ===== */
    .grid{
      margin-top: 12px;
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }
    .card{
      background: rgba(255,255,255,.78);
      border: 1px solid var(--line);
      border-radius: var(--r);
      box-shadow: 0 10px 24px rgba(2,6,23,.08);
      overflow:hidden;
      display:flex;
      flex-direction: column;
      min-height: 320px;
      transition: transform .15s ease, box-shadow .15s ease;
    }
    .card:hover{
      transform: translateY(-2px);
      box-shadow: 0 18px 34px rgba(2,6,23,.12);
    }
    .cover{
      height: 140px;
      background: linear-gradient(135deg, rgba(37,99,235,.20), rgba(6,182,212,.18));
      position: relative;
      overflow:hidden;
    }
    .cover img{
      width:100%;height:100%;object-fit:cover; display:block;
    }
    .cardBody{
      padding: 12px;
      display:flex;
      flex-direction: column;
      gap: 8px;
      flex:1;
    }
    .schoolName{
      margin:0;
      font-weight: 1000;
      font-size: 16px;
      line-height: 1.25;
    }
    .schoolAddr{
      color: var(--muted);
      font-size: 13px;
      font-weight: 700;
      line-height: 1.6;
      min-height: 42px;
    }
    .cardActions{
      display:flex;
      gap: 10px;
      margin-top:auto;
      padding-top: 8px;
      flex-wrap: wrap;
    }
    .btn{
      cursor:pointer;
      border: 1px solid transparent;
      border-radius: 14px;
      padding: 10px 12px;
      font-weight: 1000;
      font-size: 13px;
      background: linear-gradient(135deg, var(--primary), var(--primary2));
      color:#fff;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      box-shadow: 0 10px 18px rgba(37,99,235,.14);
      flex: 1 1 auto;
    }
    .btn.ghost{
      background: rgba(15,23,42,.04);
      color: var(--ink);
      border-color: rgba(15,23,42,.10);
      box-shadow: none;
    }

    .footer{
      margin-top: 22px;
      padding: 16px 0 6px;
      color: var(--muted);
      font-weight: 800;
      font-size: 13px;
      display:flex;
      gap:10px;
      justify-content:center;
      flex-wrap: wrap;
    }

    @media (max-width: 980px){
      .top3{ grid-template-columns: 1fr; }
      .grid{ grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 640px){
      .grid{ grid-template-columns: 1fr; }
      .filters input, .filters select{ min-width: 100%; }
      .count{ width:100%; margin-inline-start:0; }
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- HERO -->
    <section class="hero" aria-label="Hero">
      <div class="heroInner">
        <div class="brand">
          <div class="logo">S</div>
          <div>
            <h1 class="heroTitle">school.sy</h1>
            <div class="heroSub">
              Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…Ø¯Ø§Ø±Ø³ + ØµÙØ­Ø§Øª Ù…Ø¯Ø§Ø±Ø³ ØªÙØ§Ø¹Ù„ÙŠØ© (Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†/Ø§Ù„Ø·Ù„Ø§Ø¨ + Ù…Ù†Ø´ÙˆØ±Ø§Øª + Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª).
            </div>
          </div>
        </div>

        <div class="heroBadges">
          <div class="chip">ğŸ“ Ø§Ø¨Ø­Ø« Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</div>
          <div class="chip">ğŸ† ØªÙˆØ¨ 3 Ù…Ø¯Ø§Ø±Ø³</div>
          <div class="chip">ğŸ—ºï¸ Ø®Ø±Ø§Ø¦Ø· Google</div>
        </div>
      </div>
    </section>

    <!-- TOP 3 SCHOOLS -->
    <section class="section">
      <div class="sectionHead">
        <h2>ğŸ† Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ø¯Ø§Ø±Ø³ (Top 3)</h2>
        <div class="hint">Ø­Ø³Ø¨ Ø§Ù„ØªØµÙˆÙŠØª â€” (Ø³Ù†Ø±Ø¨Ø· Ø§Ù„ØªØµÙˆÙŠØª Ù„Ø§Ø­Ù‚Ù‹Ø§)</div>
      </div>
      <div class="top3" id="top3"></div>
    </section>

    <!-- FILTERS -->
    <section class="section">
      <div class="sectionHead">
        <h2>ğŸ« Ù…Ø¯Ø§Ø±Ø³ Ø³ÙˆØ±ÙŠØ§</h2>
        <div class="hint">Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</div>
      </div>

      <div class="filters">
        <input id="searchBox" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³Ø©..." />
        <select id="citySelect">
          <option value="">ÙƒÙ„ Ø§Ù„Ù…Ø¯Ù†</option>
        </select>
        <div class="count" id="countLabel">â€”</div>
      </div>

      <div class="grid" id="schoolsGrid"></div>
    </section>

    <div class="footer">
      <span>school.sy Â©</span>
      <span>â€¢</span>
      <span>ØªØ·ÙˆÙŠØ±: Zakaria KeFo</span>
    </div>
  </div>

  <!-- =========================
       Firebase + Home Logic
  ========================== -->
  <script type="module">
    // 1) Ø¶Ø¹ firebaseConfig Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù‡Ù†Ø§ (Ù…ÙˆØ¬ÙˆØ¯ Ø¹Ù†Ø¯Ùƒ)
    const firebaseConfig = {
      apiKey: "AIzaSyCexRHqxd8Xm_EBWMEnLj_2WAjxJcgXf9g",
      authDomain: "school-sy.firebaseapp.com",
      projectId: "school-sy",
      storageBucket: "school-sy.firebasestorage.app",
      messagingSenderId: "121186119852",
      appId: "1:121186119852:web:f96d12deade6cebbda6f09"
    };

    // 2) Imports (CDN) â€” Ù…Ù†Ø§Ø³Ø¨ Ù„Ù€ GitHub Pages
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import {
      getFirestore, collection, query, orderBy, limit, onSnapshot
    } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const $ = (id) => document.getElementById(id);

    const top3El = $("top3");
    const gridEl = $("schoolsGrid");
    const searchBox = $("searchBox");
    const citySelect = $("citySelect");
    const countLabel = $("countLabel");

    const esc = (s) => String(s || "").replace(/[&<>"']/g, c => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
    }[c]));

    // ===== Local state
    let allSchools = [];        // {id, name, city, address, logoURL, coverURL, mapsUrl, votesCount}
    let topSchools = [];        // Top 3 by votesCount

    function mapsLink(s){
      // Ø£ÙˆÙ„ÙˆÙŠØ©: Ø¥Ø°Ø§ ÙƒØ§Ù† Ø¹Ù†Ø¯Ùƒ mapsUrl Ù…Ø®Ø²Ù†
      if (s.mapsUrl) return s.mapsUrl;

      // ÙˆØ¥Ù„Ø§: Ø§Ø¨Ù†ÙŠ Ø±Ø§Ø¨Ø· Ø¨Ø­Ø« Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø§Ø³Ù… + Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© + Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
      const q = encodeURIComponent(`${s.name || ""} ${s.city || ""} ${s.address || ""}`.trim());
      return `https://www.google.com/maps/search/?api=1&query=${q}`;
    }

    function schoolPageLink(s){
      // ØµÙØ­Ø© Ø§Ù„Ù…Ø¯Ø±Ø³Ø© Ø³Ù†Ù†Ø´Ø¦Ù‡Ø§ Ù„Ø§Ø­Ù‚Ù‹Ø§
      return `./school.html?sid=${encodeURIComponent(s.id)}`;
    }

    function renderTop3(){
      top3El.innerHTML = "";
      const arr = topSchools.slice(0, 3);

      for (let i=0;i<3;i++){
        const s = arr[i] || { name:"â€”", votesCount:0, logoURL:"" };
        const el = document.createElement("div");
        el.className = "topCard";
        el.innerHTML = `
          <div class="avatar">
            ${s.logoURL ? `<img src="${esc(s.logoURL)}" alt="">` : (esc(s.name)[0] || "ØŸ")}
          </div>
          <div class="topMeta">
            <p class="topName">${esc(s.name || "â€”")}</p>
            <div class="topVotes">Ø§Ù„ØªØµÙˆÙŠØª: ${Number(s.votesCount || 0)}</div>
          </div>
          <div class="rank">#${i+1}</div>
        `;
        top3El.appendChild(el);
      }
    }

    function fillCities(){
      const cities = Array.from(new Set(allSchools.map(s => (s.city || "").trim()).filter(Boolean))).sort((a,b)=>a.localeCompare(b,'ar'));
      const current = citySelect.value;
      citySelect.innerHTML = `<option value="">ÙƒÙ„ Ø§Ù„Ù…Ø¯Ù†</option>` + cities.map(c => `<option value="${esc(c)}">${esc(c)}</option>`).join("");
      citySelect.value = current; // Ø­Ø§ÙˆÙ„ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
    }

    function applyFilters(){
      const q = (searchBox.value || "").trim().toLowerCase();
      const city = (citySelect.value || "").trim();

      const filtered = allSchools.filter(s => {
        const okCity = !city || (s.city || "").trim() === city;
        const okQ = !q || (s.name || "").toLowerCase().includes(q) || (s.address || "").toLowerCase().includes(q);
        return okCity && okQ;
      });

      renderSchools(filtered);
      countLabel.textContent = `Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¯Ø§Ø±Ø³: ${filtered.length}`;
    }

    function renderSchools(list){
      gridEl.innerHTML = "";
      if (!list.length){
        gridEl.innerHTML = `<div style="grid-column:1/-1;color:#64748b;font-weight:900;padding:10px">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø©.</div>`;
        return;
      }

      for (const s of list){
        const el = document.createElement("div");
        el.className = "card";
        el.innerHTML = `
          <div class="cover">
            ${s.coverURL ? `<img src="${esc(s.coverURL)}" alt="">` : ``}
          </div>
          <div class="cardBody">
            <h3 class="schoolName">${esc(s.name || "Ù…Ø¯Ø±Ø³Ø©")}</h3>
            <div class="schoolAddr">
              <div>ğŸ“ ${esc(s.city || "â€”")}</div>
              <div>${esc(s.address || "")}</div>
            </div>

            <div class="cardActions">
              <a class="btn ghost" href="${esc(mapsLink(s))}" target="_blank" rel="noopener">ğŸ—ºï¸ Ø®Ø±Ø§Ø¦Ø· Google</a>
              <a class="btn" href="${esc(schoolPageLink(s))}">ÙØªØ­ ØµÙØ­Ø© Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</a>
            </div>
          </div>
        `;
        gridEl.appendChild(el);
      }
    }

    // ===== Listen Schools (Firestore)
    // Ù…ØªÙˆÙ‚Ø¹ Ø£Ù† Ø¹Ù†Ø¯Ùƒ collection: schools
    // fields Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©: name, city, address, logoURL, coverURL, mapsUrl, votesCount
    const schoolsQ = query(collection(db, "schools"), orderBy("name"), limit(500));

    onSnapshot(schoolsQ, (snap) => {
      const arr = [];
      snap.forEach(doc => {
        const d = doc.data() || {};
        arr.push({
          id: doc.id,
          name: d.name || "",
          city: d.city || "",
          address: d.address || "",
          logoURL: d.logoURL || "",
          coverURL: d.coverURL || "",
          mapsUrl: d.mapsUrl || "",
          votesCount: Number(d.votesCount || 0) // Ù…Ø¤Ù‚ØªÙ‹Ø§ Ø¯Ø§Ø®Ù„ ÙˆØ«ÙŠÙ‚Ø© Ø§Ù„Ù…Ø¯Ø±Ø³Ø©
        });
      });

      allSchools = arr;

      // Top 3 Ø­Ø³Ø¨ votesCount (Ù…Ø¤Ù‚ØªÙ‹Ø§) â€” Ù„Ø§Ø­Ù‚Ù‹Ø§ Ù†Ø¬Ø¹Ù„Ù‡ Ù…Ù† leaderboards
      topSchools = [...allSchools].sort((a,b) => (b.votesCount||0) - (a.votesCount||0));

      renderTop3();
      fillCities();
      applyFilters();
    }, (err) => {
      console.error(err);
      top3El.innerHTML = `<div style="color:#b91c1c;font-weight:900">Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ø¯Ø§Ø±Ø³ Ù…Ù† Firestore. ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ collection Ø¨Ø§Ø³Ù… schools.</div>`;
    });

    // Events
    searchBox.addEventListener("input", applyFilters);
    citySelect.addEventListener("change", applyFilters);

    // UI initial
    countLabel.textContent = "ØªØ­Ù…ÙŠÙ„...";
  </script>
</body>
</html>
